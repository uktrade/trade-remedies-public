{% extends "base.html" %}
{% load format_date %}
{% load link_lookup %}
{% load organisation_name %}

{% block row_content %}
  <div class="breadcrumbs" data-module="track-click">
    <ol>
      <li class="">
        <a data-track-category="breadcrumbClicked" aria-current="false" href="{% link_lookup 'LINK_TRA_CASELIST' %}">Trade remedies</a>
      </li>
      <li class="">
        <a data-track-category="breadcrumbClicked" aria-current="false" href={% if case.archived_at %}"\public\archive\">Archived{% else %}"\public\cases\">Active{% endif %} cases</a>
      </li>
      <li>
        Case {{case.reference}} public file
      </li>
    </ol>
  </div>
  <div class="grid-row">
    <div class="column-two-thirds">
      <h1 class="heading-xlarge">{{case.reference}}</h1>
      <h1 class="heading-large">{{case.type.name}}</h1>
      <h1 class="heading-medium">{{case.name |default:'<span class="grey">&lt;Untitled&gt;</span>' }}</h1>
    </div>
    <div class="column-one-third">
      {% include "partials/widgets/help_box.html" %}
    </div>
  </div>
  <div class="grid-row">
    <div class="column-full">
      <p class="bold">The goods that are the subject of the investigation (the goods) are:</p>
      <p>{{state.PRODUCT_DESCRIPTION.value|linebreaks}}</p>
    </div>
  </div>
  <div class="grid-row">
    <div class="column-full">
      <table>
        <caption class="heading-medium">Case information</caption>
        <tbody>
          <tr><th class="bold">Applicant</th><td>{{case.applicant.name}}</td></tr>
          {% if state.TARIFF_CLASSIFICATION.value %}
            <tr><th class="bold">Tariff classification</th>
              <td>{{state.TARIFF_CLASSIFICATION.value|linebreaksbr}}</td>
            </tr>
          {% endif %}
          {% if case.initiated_at %}
            <tr><th class="bold">Initiation date</th>
              <td>{{ case.initiated_at|format_date:'%d %b %Y' }}</td>
            </tr>
          {% endif %}
          {% if state.REGISTRATION_OF_INTEREST_TIMER.date %}
            <tr><th class="bold">Registration due date</th>
              <td>{{ state.REGISTRATION_OF_INTEREST_TIMER.date|format_date:'%d %b %Y' }}</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
    <div class="column-full margin-top-1">
      <p>To register interest in this case you will need to <a href="/dashboard/">sign in or create an account with the Trade Remedies service</a>.
    </div>
  </div>
  <div class="grid-row margin-top-1">
    <div class="column-full">
      <h1 class="heading-large">Public file</h1>
        <p>The public file contains non-confidential versions of documents submitted by registered participants in the case.
        It also contains non-confidential versions of reports or other documents generated by the {% organisation_name %} during the investigation and links to all relevant public notices for the case.</p>
    <table class="public-case" data-attach="TableSort">
        <thead>
          <tr>
            <th scope="col" class="sort-active">Published date</th>
            <th scope="col">Submission</th>
            <th scope="col">Party</th>
            <th scope="col">Type</th>
          </tr>
        </thead>
        <tbody>
          {% for submission in case.submissions %}
            {% if submission.type.id != ex_officio_submission_type %}
            <tr>
              <td sortVal="{{submission.issued_at}} ">{{ submission.issued_at|format_date:'%d %b %Y' }}</td>
              <td>
                <a href="/public/case/{{case.reference}}/submission/{{submission.id}}/">{{ submission.type.name }}</a>
              </td>
              <td>
                {% if submission.deficiency_notice_params.issue_anonymously == 'yes' %}
                  (Withheld by request)
                {% else %}
                  {{ submission.organisation.name|default:submission.organisation_name }}
                {% endif %}
              </td>
              <td>
                {% if submission.deficiency_notice_params.issue_anonymously != 'yes' %}
                  {% if submission.organisation_case_role.name %}
                    {{ submission.organisation_case_role.name }}
                  {% else %}
                    N/A
                  {% endif %}
                {% endif %}
            </td>
            </tr>
            {% endif %}
          {% endfor %}
        </tbody>
    </table>
  </div>
  </div>

{% endblock %}
